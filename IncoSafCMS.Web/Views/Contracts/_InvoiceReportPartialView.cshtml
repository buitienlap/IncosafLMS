@{ var pathToTemplateXlsx = Server.MapPath("~/App_Data/Hoa don.xlsx"); }

@Html.DevExpress().Spreadsheet(settings =>
{
    settings.Name = "invoiceReportSpreadsheet";
    settings.CallbackRouteValues = new { Controller = "Contracts", Action = "InvoiceReportPartialView" };
    settings.Width = System.Web.UI.WebControls.Unit.Percentage(100);
    settings.Height = System.Web.UI.WebControls.Unit.Percentage(100);
    settings.ActiveTabIndex = 0;
    settings.ReadOnly = true;
    settings.RibbonMode = SpreadsheetRibbonMode.OneLineRibbon;
    settings.ShowConfirmOnLosingChanges = true;
    settings.ShowFormulaBar = true;
    settings.ShowSheetTabs = true;
    settings.SettingsDialogs.SaveFileDialog.DisplaySectionMode = SaveFileDialogDisplaySectionMode.ShowDownloadSection;
    settings.SettingsDocumentSelector.UploadSettings.Enabled = false;

    //settings.Init = (s, e) => { DevExpress.Web.Office.DocumentManager.CloseAllDocuments(); };

    settings.PreRender = (s, e) =>
    {
        DevExpress.Web.ASPxSpreadsheet.ASPxSpreadsheet spreadsheet = (DevExpress.Web.ASPxSpreadsheet.ASPxSpreadsheet)s;

        spreadsheet.CreateDefaultRibbonTabs(true);
        spreadsheet.BorderTop.BorderStyle = System.Web.UI.WebControls.BorderStyle.Solid;
        spreadsheet.BorderTop.BorderWidth = 1;
        spreadsheet.BorderTop.BorderColor = System.Drawing.Color.LightGray;
        spreadsheet.BorderBottom.BorderStyle = System.Web.UI.WebControls.BorderStyle.Solid;
        spreadsheet.BorderBottom.BorderWidth = 1;
        spreadsheet.BorderBottom.BorderColor = System.Drawing.Color.LightGray;

        for (int i = 0; i < spreadsheet.RibbonTabs.Count; i++)
        {
            if (i == 0) { spreadsheet.RibbonTabs[0].Text = "TỆP TIN"; continue; }
            spreadsheet.RibbonTabs[i].Visible = true;
        }

        DevExpress.Web.RibbonTab fileTab = spreadsheet.RibbonTabs[0];
        fileTab.Groups[0].Items[0].Visible = true;
        fileTab.Groups[0].Items[1].Visible = true;
        fileTab.Groups[0].Items[2].Visible = true;
        fileTab.Groups[0].Items[3].Text = "Lưu tệp";
        fileTab.Groups[0].Items[4].Text = "In ấn";


        IncosafCMS.Web.Helpers.CustomInvoiceReportHelper.PerformDataMerging(spreadsheet.Document.Worksheets[0]);
        
    };

}).Open(pathToTemplateXlsx).GetHtml()
